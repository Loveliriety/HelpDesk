@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Team List";
}
<div class="content p-4" style="margin-left: 80px;">
    <h5 class="mt-1 page-header">Team List</h5>

    <nav class="nav mt-3 nav-header">
        <a class="nav-link" asp-action="Index" asp-controller="UserManagement">User List</a>
        <a class="nav-link" asp-action="TeamList" asp-controller="UserManagement">Team List</a>
    </nav>
    <hr />

    <!-- Search bar and Add User button -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <input type="text" class="form-control w-25" id="searchInput" placeholder="Search..." />
        <button class="btn btn-sm assign-btn add-user-btn">+ Add Table</button>
    </div>

    <!-- Team Table -->
    <table class="table table-striped table-bordered" id="teamTable">
        <thead>
            <tr>
                <th scope="col">Team ID</th>
                <th scope="col">Name</th>
                <th scope="col">Company</th>
                <th scope="col">Tier</th>
                <th scope="col">Manager</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var team in Model)
            {
                <tr>
                    <td>@team.TeamID</td>
                    <td>@team.Name</td>
                    <td>@team.Company</td>
                    <td>@team.Tier</td>
                    <td>@team.Manager</td>
                    <td>
                        <button class="btn btn-sm btn-primary edit-team-btn"
                                data-id="@team.TeamID"
                                data-name="@team.Name"
                                data-company="@team.Company"
                                data-tier="@team.Tier"
                                data-manager="@team.Manager">
                            Edit
                        </button>
                        <a asp-action="Delete" asp-route-id="@team.TeamID" class="btn btn-sm btn-danger">Delete</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Add User Drawer -->
<div class="custom-drawer" id="addTeamDrawer">
    <img src="~/img/side-caret.svg" type="button" class="mt-4 ml-3 btn" onclick="toggleAddDrawer()" />
    <div class="custom-drawer-header d-flex justify-content-between">
        <h5>Add Team</h5>
    </div>
    <div class="custom-drawer-body">
        <form asp-action="Create" asp-controller="TeamList" method="post">
            <div class="mb-3">
                <label for="nameInput" class="form-label">Name</label>
                <input type="text" class="form-control" id="nameInput" name="Name" required />
            </div>
            <div class="mb-3">
                <label for="companySelect" class="form-label">Company</label>
                <select class="form-select" id="companySelect" name="Company" required>
                    <option selected disabled value="">Select a company</option>
                    <option value="Company A">Company A</option>
                    <option value="Company B">Company B</option>
                    <option value="Company C">Company C</option>
                    <option value="Company D">Company D</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="tierSelect" class="form-label">Tier</label>
                <select class="form-select" id="tierSelect" name="Tier" required>
                    <option selected disabled value="">Select a tier</option>
                    <option value="Tier 1">Tier 1</option>
                    <option value="Tier 2">Tier 2</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="managerInput" class="form-label">Manager</label>
                <input type="text" class="form-control" id="managerInput" name="Manager" required />
            </div>
            <div class="mt-2 d-flex justify-content-end">
                <button type="submit" class="btn save-btn">Add Table</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit User Drawer -->
<div class="custom-drawer" id="editTableDrawer">
    <img src="~/img/side-caret.svg" type="button" class="mt-4 ml-3 btn" onclick="toggleEditDrawer()" />
    <div class="custom-drawer-header d-flex justify-content-between">
        <h5>Edit Table</h5>
    </div>
    <div class="custom-drawer-body">
        <form asp-action="Edit" asp-controller="TeamList" method="post">
            <input type="hidden" id="editTeamIdInput" name="TeamID" />
            <div class="mb-3">
                <label for="editNameInput" class="form-label">Name</label>
                <input type="text" class="form-control" id="editNameInput" name="Name" required />
            </div>
            <div class="mb-3">
                <label for="editCompanySelect" class="form-label">Company</label>
                <select class="form-select" id="editCompanySelect" name="Company" required>
                    <option selected disabled value="">Select a company</option>
                    <option value="Company A">Company A</option>
                    <option value="Company B">Company B</option>
                    <option value="Company C">Company C</option>
                    <option value="Company D">Company D</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="editTierSelect" class="form-label">Tier</label>
                <select class="form-select" id="editTierSelect" name="Tier" required>
                    <option selected disabled value="">Select a tier</option>
                    <option value="Tier 1">Tier 1</option>
                    <option value="Tier 2">Tier 2</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="editManagerInput" class="form-label">Manager</label>
                <input type="text" class="form-control" id="editManagerInput" name="Manager" required />
            </div>
            <div class="mt-2 d-flex justify-content-end">
                <button type="submit" class="btn save-btn">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<!-- Drawer Backdrop -->
<div class="drawer-backdrop" id="drawerBackdrop"></div>

@section Scripts {
    <script>
        function toggleAddDrawer() {
            const drawer = document.getElementById("addTeamDrawer");
            const backdrop = document.getElementById("drawerBackdrop");
            drawer.classList.toggle("show");
            backdrop.classList.toggle("show");
        }

        function toggleEditDrawer() {
            const drawer = document.getElementById("editTableDrawer");
            const backdrop = document.getElementById("drawerBackdrop");
            drawer.classList.toggle("show");
            backdrop.classList.toggle("show");
        }

        document.querySelector('.add-user-btn').addEventListener('click', function () {
            toggleAddDrawer();
        });

        document.querySelectorAll('.edit-team-btn').forEach(button => {
            button.addEventListener('click', function () {
                document.getElementById("editTeamIdInput").value = this.getAttribute("data-id");
                document.getElementById("editNameInput").value = this.getAttribute("data-name");
                document.getElementById("editCompanySelect").value = this.getAttribute("data-company");
                document.getElementById("editTierSelect").value = this.getAttribute("data-tier");
                document.getElementById("editManagerInput").value = this.getAttribute("data-manager");
                toggleEditDrawer();
            });
        });

        document.getElementById("drawerBackdrop").addEventListener('click', function () {
            const addDrawer = document.getElementById("addTeamDrawer");
            const editDrawer = document.getElementById("editTableDrawer");
            if (addDrawer.classList.contains("show")) toggleAddDrawer();
            if (editDrawer.classList.contains("show")) toggleEditDrawer();
        });

        document.getElementById('searchInput').addEventListener('keyup', function () {
            let filter = this.value.toLowerCase();
            let rows = document.querySelectorAll('#teamTable tbody tr');

            rows.forEach(row => {
                let name = row.cells[2].textContent.toLowerCase();
                let email = row.cells[3].textContent.toLowerCase();
                let role = row.cells[4].textContent.toLowerCase();

                if (name.includes(filter) || email.includes(filter) || role.includes(filter)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    </script>
}

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-k6RqeWeci5ZR/Lv4MR0sA0FfDOMf8A6sa1XbKf7RQkvIQ1KHB12XhlD8/Wr11T5z" crossorigin="anonymous">
</head>
