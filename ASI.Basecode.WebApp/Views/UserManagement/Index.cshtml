@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "User Management";
}

<div class="content p-4" style="margin-left: 80px;">
    <h5 class="mt-1 page-header">User Management</h5>

    <nav class="nav mt-3 nav-header">
        <a class="nav-link" asp-action="Index" asp-controller="UserManagement">User List</a>
        <a class="nav-link" asp-action="MyTicket" asp-controller="Users">Team List</a>
    </nav>
    <hr />

    <!-- Search bar and Add User button -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <input type="text" class="form-control w-25" id="searchInput" placeholder="Search..." />
        <button class="btn btn-sm assign-btn add-user-btn">+ Add User</button>
    </div>

    <!-- User Table -->
    <table class="table table-striped table-bordered" id="userTable">
        <thead>
            <tr>
                <th scope="col"><input type="checkbox" id="select-all" /></th>
                <th scope="col">User ID</th>
                <th scope="col">Name</th>
                <th scope="col">Email</th>
                <th scope="col">Team</th>
                <th scope="col">Role</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model)
            {
                <tr>
                    <td><input type="checkbox" class="select-checkbox" /></td>
                    <td>@user.UserId</td>
                    <td>@user.Name</td>
                    <td>@user.Email</td>
                    <td>@user.TeamId</td>
                    <td>@user.Role</td>
                    <td>
                        <button class="btn btn-sm btn-primary edit-user-btn"
                                data-id="@user.UserId"
                                data-name="@user.Name"
                                data-email="@user.Email"
                                data-team="@user.TeamId"
                                data-role="@user.Role"
                                data-password="@user.Password">
                            Edit
                        </button>
                        <a asp-action="Delete" asp-route-id="@user.UserId" class="btn btn-sm btn-danger">Delete</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Add User Drawer -->
<div class="custom-drawer" id="addUserDrawer">
    <img src="~/img/side-caret.svg" type="button" class="mt-4 ml-3 btn" onclick="toggleAddDrawer()" />
    <div class="custom-drawer-header d-flex justify-content-between">
        <h5>Add User</h5>
    </div>
    <div class="custom-drawer-body">
        <form asp-action="Create" asp-controller="UserManagement" method="post">
            <div class="mb-3">
                <label for="userIdInput" class="form-label">User Id</label>
                <input type="text" class="form-control" id="userIdInput" name="UserId" required />
            </div>
            <div class="mb-3">
                <label for="nameInput" class="form-label">Name</label>
                <input type="text" class="form-control" id="nameInput" name="Name" required />
            </div>
            <div class="mb-3">
                <label for="emailInput" class="form-label">Email</label>
                <input type="email" class="form-control" id="emailInput" name="Email" required />
            </div>
            <div class="mb-3">
                <label for="teamSelect" class="form-label">Team</label>
                <select class="form-select" id="teamSelect" name="TeamId" required>
                    <option selected disabled value="">Select a team</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="4">4</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="roleSelect" class="form-label">Role</label>
                <select class="form-select" id="roleSelect" name="Role" required>
                    <option selected disabled value="">Select a role</option>
                    <option value="Superadmin">Superadmin</option>
                    <option value="Admin">Admin</option>
                    <option value="Support Agent">Support Agent</option>
                    <option value="User">User</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="passwordInput" class="form-label">Password</label>
                <div class="input-group">
                    <input type="password" class="form-control" id="passwordInput" name="Password" required />
                    <button type="button" class="btn btn-outline-secondary" id="toggleAddPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            <div class="mt-2 d-flex justify-content-end">
                <button type="submit" class="btn save-btn">Add User</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit User Drawer -->
<div class="custom-drawer" id="editUserDrawer">
    <img src="~/img/side-caret.svg" type="button" class="mt-4 ml-3 btn" onclick="toggleEditDrawer()" />
    <div class="custom-drawer-header d-flex justify-content-between">
        <h5>Edit User</h5>
    </div>
    <div class="custom-drawer-body">
        <form asp-action="Edit" asp-controller="UserManagement" method="post">
            <input type="hidden" id="editUserIdInput" name="UserId" />
            <div class="mb-3">
                <label for="editNameInput" class="form-label">Name</label>
                <input type="text" class="form-control" id="editNameInput" name="Name" required />
            </div>
            <div class="mb-3">
                <label for="editEmailInput" class="form-label">Email</label>
                <input type="email" class="form-control" id="editEmailInput" name="Email" required />
            </div>
            <div class="mb-3">
                <label for="editTeamSelect" class="form-label">Team</label>
                <select class="form-select" id="editTeamSelect" name="TeamId" required>
                    <option selected disabled value="">Select a team</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="4">4</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="editRoleSelect" class="form-label">Role</label>
                <select class="form-select" id="editRoleSelect" name="Role" required>
                    <option selected disabled value="">Select a role</option>
                    <option value="Superadmin">Superadmin</option>
                    <option value="Admin">Admin</option>
                    <option value="Support Agent">Support Agent</option>
                    <option value="User">User</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="editPasswordInput" class="form-label">Password</label>
                <div class="input-group">
                    <input type="password" class="form-control" id="editPasswordInput" name="Password" value="" />
                    <button type="button" class="btn btn-outline-secondary" id="togglePassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            <div class="mt-2 d-flex justify-content-end">
                <button type="submit" class="btn save-btn">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<!-- Drawer Backdrop -->
<div class="drawer-backdrop" id="drawerBackdrop"></div>

@section Scripts {
    <script>
        function toggleAddDrawer() {
            const drawer = document.getElementById("addUserDrawer");
            const backdrop = document.getElementById("drawerBackdrop");
            drawer.classList.toggle("show");
            backdrop.classList.toggle("show");
        }

        function toggleEditDrawer() {
            const drawer = document.getElementById("editUserDrawer");
            const backdrop = document.getElementById("drawerBackdrop");
            drawer.classList.toggle("show");
            backdrop.classList.toggle("show");
        }

        document.querySelector('.add-user-btn').addEventListener('click', function () {
            toggleAddDrawer();
        });

        document.querySelectorAll('.edit-user-btn').forEach(button => {
            button.addEventListener('click', function () {
                document.getElementById("editUserIdInput").value = this.getAttribute("data-id");
                document.getElementById("editNameInput").value = this.getAttribute("data-name");
                document.getElementById("editEmailInput").value = this.getAttribute("data-email");
                document.getElementById("editTeamSelect").value = this.getAttribute("data-team");
                document.getElementById("editRoleSelect").value = this.getAttribute("data-role");
                document.getElementById("editPasswordInput").value = this.getAttribute("data-password");
                toggleEditDrawer();
            });
        });

        document.getElementById("drawerBackdrop").addEventListener('click', function () {
            const addDrawer = document.getElementById("addUserDrawer");
            const editDrawer = document.getElementById("editUserDrawer");
            if (addDrawer.classList.contains("show")) toggleAddDrawer();
            if (editDrawer.classList.contains("show")) toggleEditDrawer();
        });

        document.getElementById('select-all').addEventListener('click', function () {
            let checkboxes = document.querySelectorAll('.select-checkbox');
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        document.getElementById('togglePassword').addEventListener('click', function () {
            const passwordInput = document.getElementById('editPasswordInput');
            const icon = this.querySelector('i');

            if (passwordInput.type === 'text') {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            } else {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            }
        });

        document.getElementById('toggleAddPassword').addEventListener('click', function () {
            const passwordInput = document.getElementById('passwordInput');
            const icon = this.querySelector('i');

            if (passwordInput.type === 'text') {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            } else {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            }
        });

        document.getElementById('searchInput').addEventListener('keyup', function () {
            let filter = this.value.toLowerCase();
            let rows = document.querySelectorAll('#userTable tbody tr');

            rows.forEach(row => {
                let name = row.cells[2].textContent.toLowerCase();
                let email = row.cells[3].textContent.toLowerCase();
                let role = row.cells[4].textContent.toLowerCase();

                if (name.includes(filter) || email.includes(filter) || role.includes(filter)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    </script>
}

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-k6RqeWeci5ZR/Lv4MR0sA0FfDOMf8A6sa1XbKf7RQkvIQ1KHB12XhlD8/Wr11T5z" crossorigin="anonymous">
</head>